<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Social App</title>

  <!-- Tailwind CSS CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React and ReactDOM CDNs -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel CDN for JSX support in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Firebase SDKs -->
  <script type="module">
    // Import Firebase services directly
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    window.firebase = { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut };
    window.firestore = { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot, query, where };
  </script>

  <style>
    .app-input {
      @apply w-full px-4 py-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500;
    }

    .app-button-primary {
      @apply w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300;
    }

    .app-button-danger {
      @apply w-full bg-red-500 text-white font-semibold py-3 rounded-lg hover:bg-red-600 transition duration-300;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <!-- Main React application script -->
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } = window.firebase;
    const { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot, query, where } = window.firestore;

    // Firebase config (use your actual config here)
    const firebaseConfig = {
      apiKey: "your-api-key",
      authDomain: "your-auth-domain",
      projectId: "your-project-id",
      storageBucket: "your-storage-bucket",
      messagingSenderId: "your-messaging-sender-id",
      appId: "your-app-id"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const ADMIN_ID = 'admin';
    const ADMIN_PASSWORD = 'FARHAN';

    const App = () => {
      const [currentPage, setCurrentPage] = useState('login');
      const [user, setUser] = useState(null);
      const [role, setRole] = useState('');
      const [schoolId, setSchoolId] = useState('');
      const [loginId, setLoginId] = useState('');
      const [loginPassword, setLoginPassword] = useState('');
      const [registerSchoolId, setRegisterSchoolId] = useState('');
      const [registerPassword, setRegisterPassword] = useState('');
      const [postTitle, setPostTitle] = useState('');
      const [postContent, setPostContent] = useState('');
      const [schoolPosts, setSchoolPosts] = useState([]);

      const showMessage = (message) => {
        alert(message);
      };

      useEffect(() => {
        onAuthStateChanged(auth, (currentUser) => {
          if (currentUser) {
            setUser(currentUser);
          }
        });
      }, []);

      const handleLogin = async () => {
        if (loginId === ADMIN_ID && loginPassword === ADMIN_PASSWORD) {
          showMessage('Admin login successful!');
          setRole('admin');
          setCurrentPage('admin-dashboard');
          return;
        }

        try {
          const docRef = doc(db, "accounts", loginId);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            const { passwordHash, role } = docSnap.data();
            if (role !== 'school') {
              showMessage('Invalid role for this account.');
              return;
            }
            const match = await bcrypt.compare(loginPassword, passwordHash);
            if (match) {
              showMessage('School login successful!');
              setRole('school');
              setSchoolId(loginId);
              setCurrentPage('school-dashboard');
            } else {
              showMessage('Invalid password.');
            }
          } else {
            showMessage('Account ID not found.');
          }
        } catch (error) {
          console.error("Login failed:", error);
          showMessage(`Login failed: ${error.message}`);
        }
      };

      const handlePost = async () => {
        if (!postTitle || !postContent) {
          showMessage('Please provide both title and content.');
          return;
        }

        try {
          await addDoc(collection(db, 'posts'), {
            title: postTitle,
            content: postContent,
            schoolId,
            createdAt: new Date().toISOString(),
          });
          showMessage('Post created successfully!');
          setPostTitle('');
          setPostContent('');
        } catch (error) {
          showMessage(`Failed to create post: ${error.message}`);
        }
      };

      const renderLoginPage = () => (
        <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
          <h2 className="text-3xl font-bold text-gray-800 text-center mb-6">Login</h2>
          <input
            type="text"
            placeholder="Account ID"
            className="app-input"
            value={loginId}
            onChange={(e) => setLoginId(e.target.value)}
          />
          <input
            type="password"
            placeholder="Password"
            className="app-input"
            value={loginPassword}
            onChange={(e) => setLoginPassword(e.target.value)}
          />
          <button onClick={handleLogin} className="app-button-primary">Login</button>
        </div>
      );

      const renderSchoolDashboard = () => (
        <div className="bg-indigo-500 text-white p-8 rounded-lg shadow-xl w-full max-w-2xl">
          <h2 className="text-3xl font-bold text-center mb-4">Dashboard for {schoolId}</h2>
          <div className="mb-6">
            <h3 className="text-2xl font-semibold mb-4">Create a New Post</h3>
            <input
              type="text"
              placeholder="Post Title"
              className="app-input"
              value={postTitle}
              onChange={(e) => setPostTitle(e.target.value)}
            />
            <textarea
              placeholder="What's the news?"
              className="app-input h-32"
              value={postContent}
              onChange={(e) => setPostContent(e.target.value)}
            ></textarea>
            <button onClick={handlePost} className="app-button-primary">Post News</button>
          </div>
        </div>
      );

      return (
        <div className="min-h-screen bg-gray-100 flex items-center justify-center p-4">
          {currentPage === 'login' && renderLoginPage()}
          {currentPage === 'school-dashboard' && renderSchoolDashboard()}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>

